
{% extends "base.html" %}
{% block content %}
  <div class="detail-container {% if mode == 'episode_torrents' %}single-column{% endif %}">
    {% if mode != 'episode_torrents' %}
    <!-- Poster sekce jen pro normÃ¡lnÃ­ detail -->
    <div class="detail-poster">
      {% if poster %}
        <img src="{{ poster }}" alt="{{ title }}">
      {% else %}
        <div class="poster-placeholder">ğŸ¬</div>
      {% endif %}
    </div>
    {% endif %}

    <div class="detail-info">
      {% if mode == 'episode_torrents' %}
        <!-- EPISODE TORRENTS MODE -->
        <h1>ğŸ” VyhledÃ¡vÃ¡nÃ­ torrentÅ¯</h1>
        <p class="detail-subtitle">
          {{ title }} - S{{ season }}E{{ episode }}
          {% if episode_name %} - {{ episode_name }}{% endif %}
        </p>

        <div class="breadcrumb">
          <a href="/season/{{ tmdb_id }}/{{ season }}">&larr; ZpÄ›t na sezÃ³nu</a>
        </div>

        <!-- Include unified video player -->
        {% include 'video_player.html' %}

        <!-- AutomatickÃ© vyhledÃ¡vÃ¡nÃ­ -->
        <div class="torrent-section">
          <h3 class="section-title">ğŸ¯ AutomatickÃ© vyhledÃ¡vÃ¡nÃ­</h3>
          <button id="episode-search-btn" onclick="searchTorrents('episode')" class="search-btn">
            ğŸ” Vyhledat torrenty pro S{{ season }}E{{ episode }}
          </button>
          <div id="episode-torrent-list" class="torrent-list" style="display:none;"></div>
        </div>

        <!-- RuÄnÃ­ vyhledÃ¡vÃ¡nÃ­ -->
        <div class="torrent-section">
          <h3 class="section-title">ğŸ”§ RuÄnÃ­ vyhledÃ¡vÃ¡nÃ­</h3>
          <form onsubmit="manualSearch(event, 'episode')" class="search-form-inline">
            <input type="text" id="episode-manual-query" placeholder="Zadej vlastnÃ­ vyhledÃ¡vacÃ­ termÃ­n..." class="magnet-input">
            <button type="submit" class="search-btn">ğŸ” Hledat</button>
          </form>
          <div id="episode-manual-torrent-list" class="torrent-list" style="display:none;"></div>
        </div>

        <!-- AJAX Magnet form pro epizodu -->
        <div class="torrent-section">
          <h3 class="section-title">ğŸ“ Nebo vloÅ¾ magnet link</h3>
          <form id="episode-magnet-form" class="magnet-form" onsubmit="submitMagnet(event, 'episode')">
            <input type="text" id="episode-magnet-input" name="magnet" placeholder="magnet:?xt=urn:btih:..." required class="magnet-input">
            <button type="submit" id="episode-magnet-submit" class="submit-btn">â–¶ï¸ Spustit stream epizody</button>
          </form>
          <div id="episode-stream-messages" class="stream-messages"></div>
        </div>

      {% else %}
        <!-- NORMAL TITLE DETAIL MODE -->
        <h1>{{ title }}</h1>

        {% if english_title and english_title != title %}
          <p class="detail-subtitle">ğŸŒ PÅ¯vodnÃ­ nÃ¡zev: {{ english_title }}</p>
        {% endif %}

        {% if year %}
          <p class="detail-year">ğŸ“… {{ year }}</p>
        {% endif %}

        <!-- IMDB odkaz -->
        {% if imdb_url %}
          <div class="external-links">
            <a href="{{ imdb_url }}" target="_blank" class="imdb-link">ğŸ¬ IMDB</a>
          </div>
        {% endif %}

        <!-- Obsah pro film/seriÃ¡l -->
        {% if overview %}
          <div class="overview">
            <h3 class="section-title">ğŸ“– PÅ™ehled</h3>
            <p>{{ overview }}</p>
          </div>
        {% endif %}

        <!-- SezÃ³ny (pouze pro seriÃ¡ly) -->
        {% if seasons %}
          <div class="seasons-section">
            <h3 class="section-title">ğŸ“º SezÃ³ny</h3>
            <div class="seasons-grid">
              {% for season in seasons %}
                <a href="/season/{{ tmdb_id }}/{{ season.season_number }}" class="season-card">
                  <div class="season-poster">
                    {% if season.poster_path %}
                      <img src="https://image.tmdb.org/t/p/w300{{ season.poster_path }}" alt="{{ season.name }}">
                    {% else %}
                      <div class="poster-placeholder">ğŸ“º</div>
                    {% endif %}
                  </div>
                  <div class="season-info">
                    <h4>{{ season.name }}</h4>
                    <p>{{ season.episode_count }} epizod</p>
                    {% if season.air_date %}
                      <p>{{ season.air_date.split('-')[0] }}</p>
                    {% endif %}
                  </div>
                </a>
              {% endfor %}
            </div>
          </div>
        {% endif %}

        <!-- Include unified video player -->
        {% include 'video_player.html' %}

        <!-- VYHLEDÃVÃNÃ TORRENTÅ® PRO FILMY/SERIÃLY -->
        <div class="torrent-section">
          <h3 class="section-title">ğŸ¯ Vyhledat torrenty</h3>
          <button id="main-search-btn" onclick="searchTorrents('main')" class="search-btn">
            ğŸ” Vyhledat torrenty pro "{{ title }}"
          </button>
          <div id="main-torrent-list" class="torrent-list" style="display:none;"></div>
        </div>

        <!-- RuÄnÃ­ vyhledÃ¡vÃ¡nÃ­ pro filmy/seriÃ¡ly -->
        <div class="torrent-section">
          <h3 class="section-title">ğŸ”§ RuÄnÃ­ vyhledÃ¡vÃ¡nÃ­</h3>
          <form onsubmit="manualSearch(event, 'main')" class="search-form-inline">
            <input type="text" id="main-manual-query" placeholder="Zadej vlastnÃ­ vyhledÃ¡vacÃ­ termÃ­n..." class="magnet-input">
            <button type="submit" class="search-btn">ğŸ” Hledat</button>
          </form>
          <div id="main-manual-torrent-list" class="torrent-list" style="display:none;"></div>
        </div>

        <!-- AJAX Magnet form pro film/celÃ½ seriÃ¡l -->
        <div class="torrent-section">
          <h3 class="section-title">ğŸ“ Nebo vloÅ¾ magnet link</h3>
          <form id="main-magnet-form" class="magnet-form" onsubmit="submitMagnet(event, 'main')">
            <input type="text" id="main-magnet-input" name="magnet" placeholder="magnet:?xt=urn:btih:..." required class="magnet-input">
            <button type="submit" id="main-magnet-submit" class="submit-btn">â–¶ï¸ Spustit stream</button>
          </form>
          <div id="main-stream-messages" class="stream-messages"></div>
        </div>

        <!-- ZÃ¡kladnÃ­ informace -->
        {% if tagline %}
          <div class="tagline">
            <h3 class="section-title">ğŸ’« Slogan</h3>
            <p class="tagline-text">"{{ tagline }}"</p>
          </div>
        {% endif %}

        {% if rating %}
          <div class="rating-section">
            <h3 class="section-title">â­ HodnocenÃ­</h3>
            <div class="rating-details">
              <span class="rating-score">{{ rating_formatted }}</span>
              {% if vote_count %}
                <span class="rating-count">({{ vote_count }} hodnocenÃ­)</span>
              {% endif %}
              {% if popularity %}
                <span class="popularity">Popularita: {{ "%.1f"|format(popularity) }}</span>
              {% endif %}
            </div>
          </div>
        {% endif %}

        <!-- TechnickÃ© detaily -->
        {% if media_type == 'movie' %}
          <div class="movie-details">
            <h3 class="section-title">ğŸ¬ Detaily filmu</h3>
            <div class="details-grid">
              {% if runtime %}
                <div class="detail-item"><strong>â±ï¸ DÃ©lka:</strong> {{ runtime }} minut</div>
              {% endif %}
              {% if status %}
                <div class="detail-item"><strong>ğŸ“‹ Status:</strong> {{ status }}</div>
              {% endif %}
              {% if budget and budget > 0 %}
                <div class="detail-item"><strong>ğŸ’° RozpoÄet:</strong> ${{ "{:,}".format(budget) }}</div>
              {% endif %}
              {% if revenue and revenue > 0 %}
                <div class="detail-item"><strong>ğŸ’¸ TrÅ¾by:</strong> ${{ "{:,}".format(revenue) }}</div>
              {% endif %}
            </div>
          </div>
        {% endif %}

        {% if media_type == 'tv' %}
          <div class="tv-details">
            <h3 class="section-title">ğŸ“º Detaily seriÃ¡lu</h3>
            <div class="details-grid">
              {% if number_of_seasons %}
                <div class="detail-item"><strong>ğŸ“š PoÄet sezÃ³n:</strong> {{ number_of_seasons }}</div>
              {% endif %}
              {% if number_of_episodes %}
                <div class="detail-item"><strong>ğŸ“º PoÄet epizod:</strong> {{ number_of_episodes }}</div>
              {% endif %}
              {% if status %}
                <div class="detail-item"><strong>ğŸ“‹ Status:</strong> {{ status }}</div>
              {% endif %}
              {% if last_air_date %}
                <div class="detail-item"><strong>ğŸ“… PoslednÃ­ dÃ­l:</strong> {{ last_air_date }}</div>
              {% endif %}
            </div>
          </div>
        {% endif %}

        <!-- ObsazenÃ­ -->
        {% if cast %}
          <div class="cast-section">
            <h3 class="section-title">ğŸ‘¥ HlavnÃ­ role</h3>
            <div class="cast-grid">
              {% for actor in cast[:8] %}
                <div class="cast-member">
                  {% if actor.profile_path %}
                    <img src="{{ actor.profile_path }}" alt="{{ actor.name }}" class="cast-photo">
                  {% else %}
                    <div class="cast-photo-placeholder">ğŸ‘¤</div>
                  {% endif %}
                  <div class="cast-info">
                    <div class="cast-name">{{ actor.name }}</div>
                    <div class="cast-character">{{ actor.character }}</div>
                  </div>
                </div>
              {% endfor %}
            </div>
          </div>
        {% endif %}

      {% endif %}
    </div>
  </div>

  <!-- Include unified JavaScript -->
  {% include 'video_player_script.html' %}

  <!-- Debug script -->
  <script>
  // Add debug information
  console.log('Current mode:', '{{ mode }}');
  console.log('Season:', {{ season if season else 'null' }});
  console.log('Episode:', {{ episode if episode else 'null' }});
  </script>

  <style>
  .stream-messages {
    margin-top: 10px;
  }
  .loading {
    color: #ffa500;
    font-weight: 500;
    padding: 10px;
  }
  .success {
    color: #28a745;
    font-weight: 500;
    padding: 10px;
    background: rgba(40, 167, 69, 0.1);
    border-radius: 5px;
  }
  .error {
    color: #dc3545;
    font-weight: 500;
    padding: 10px;
    background: rgba(220, 53, 69, 0.1);
    border-radius: 5px;
  }
  </style>
{% endblock %}