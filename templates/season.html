{% extends "base.html" %}
{% block content %}
  <div class="detail-container">
    <div class="detail-poster">
      {% if poster %}
        <img src="{{ poster }}" alt="{{ season_name }}">
      {% else %}
        <div class="poster-placeholder">游닠</div>
      {% endif %}
    </div>

    <div class="detail-info">
      <h1>{{ title }} - {{ season_name }}</h1>

      {% if english_title and english_title != title %}
        <p class="detail-subtitle">游깴 P콢vodn칤 n치zev: {{ english_title }}</p>
      {% endif %}

      <div class="breadcrumb">
        <a href="/title/tv/{{ tmdb_id }}">&larr; Zp캩t na detail seri치lu</a>
      </div>

      <!-- Epizody -->
      <div class="episodes-section">
        <h3 class="section-title">游닠 Epizody</h3>
        <div class="episodes-grid">
          {% for episode in episodes %}
            <div class="episode-card" onclick="searchEpisodeTorrents('{{ english_title or title }}', {{ season_number }}, {{ episode.episode_number }}, '{{ episode.name }}')">
              <div class="episode-number">{{ episode.episode_number }}</div>
              <div class="episode-info">
                <h4>{{ episode.name }}</h4>
                {% if episode.overview %}
                  <p class="episode-overview">{{ episode.overview[:150] }}{% if episode.overview|length > 150 %}...{% endif %}</p>
                {% endif %}
                {% if episode.air_date %}
                  <div class="episode-meta">游늰 {{ episode.air_date }}</div>
                {% endif %}
              </div>
            </div>
          {% endfor %}
        </div>
      </div>

      <!-- Include unified video player -->
      {% include 'video_player.html' %}

      <!-- Vyhled치v치n칤 torrent콢 pro celou sez칩nu -->
      <div class="torrent-section">
        <h3 class="section-title">游꿢 Vyhledat torrenty pro celou sez칩nu</h3>
        <button id="season-search-btn" onclick="searchTorrents('season')" class="search-btn">
          游댌 Vyhledat torrenty pro "{{ season_name }}"
        </button>
        <div id="season-torrent-list" class="torrent-list" style="display:none;"></div>
      </div>

      <!-- AJAX Magnet form pro celou sez칩nu -->
      <div class="torrent-section">
        <h3 class="section-title">游늹 Nebo vlo magnet link pro celou sez칩nu</h3>
        <form id="season-magnet-form" class="magnet-form" onsubmit="submitMagnet(event, 'season')">
          <input type="text" id="season-magnet-input" name="magnet" placeholder="magnet:?xt=urn:btih:..." required class="magnet-input">
          <button type="submit" id="season-magnet-submit" class="submit-btn">郊윒잺 Spustit stream cel칠 sez칩ny</button>
        </form>
        <div id="season-stream-messages" class="stream-messages"></div>
      </div>
    </div>
  </div>

  <!-- Include unified JavaScript -->
  {% include 'video_player_script.html' %}

  <script>
  function searchEpisodeTorrents(title, season, episode, episodeName) {
    const params = new URLSearchParams({
      title: title,
      english_title: '{{ english_title }}',
      season: season,
      episode: episode,
      episodeName: episodeName,
      tmdb_id: '{{ tmdb_id }}'
    });

    window.location.href = '/episode-torrents?' + params.toString();
  }
  </script>

  <style>
  .stream-messages {
    margin-top: 10px;
  }
  .loading {
    color: #ffa500;
    font-weight: 500;
    padding: 10px;
  }
  .success {
    color: #28a745;
    font-weight: 500;
    padding: 10px;
    background: rgba(40, 167, 69, 0.1);
    border-radius: 5px;
  }
  .error {
    color: #dc3545;
    font-weight: 500;
    padding: 10px;
    background: rgba(220, 53, 69, 0.1);
    border-radius: 5px;
  }
  </style>
{% endblock %}